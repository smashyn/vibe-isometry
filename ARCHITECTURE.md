# Архітектура проєкту

## Серверна частина

### Основні компоненти (сервер)

#### 1. UserManager

- Відповідає за реєстрацію, аутентифікацію, видачу та перевірку токенів.
- Зберігає інформацію про користувачів, їх токени, дату дії токена.

#### 2. CharacterManager

- Операції над персонажами: створення, оновлення, видалення.
- Перевіряє токен користувача через UserManager.
- Один користувач може мати багато персонажів, але лише один активний.

#### 3. PlayerManager

- Зберігає інформацію про користувачів у грі (UserData).
- UserData містить: id, username, token, список персонажів, activeCharacterId, activeRoom.
- Дозволяє керувати активним персонажем та активною кімнатою користувача.

#### 4. RoomManager

- Зберігає всі кімнати (Room).
- Room: id, name, admin, players[], status (ACTIVE, GAME, INACTIVE).
- Адмін може редагувати/видаляти кімнату.
- Користувач може приєднатись/вийти з кімнати.
- При створенні/приєднанні/видаленні/зміні статусу кімнати оновлюється activeRoom у UserData.

#### 5. WebSocket (WSMessageHandler)

- Зберігає всі підключення (allClients).
- Розсилає оновлений список кімнат усім клієнтам при змінах.
- Всі події (створення, редагування, видалення, приєднання, вихід з кімнати) обробляються окремими хендлерами.

---

## Клієнтська частина

### Сцени (client scenes)

- **LoginScene** — логін користувача, перевірка токена, перехід до RegisterScene або MainScene.
- **RegisterScene** — реєстрація нового користувача, перехід до LoginScene після успіху.
- **MainScene** — головне лобі, список кімнат, створення/приєднання до кімнати, перехід до RoomScene.
- **RoomScene** — інтерфейс кімнати, список гравців, старт гри, перехід до GameScene.
- **GameScene** — основний ігровий процес, взаємодія з персонажами та іншими гравцями.
- **(Можливі додаткові сцени: CharacterSelectScene, SettingsScene, TabsPanel, CanvasList тощо)**

---

### Взаємодія між сценами

- **LoginScene**  
  → (успішний логін) → **MainScene**  
  → (перехід до реєстрації) → **RegisterScene**

- **RegisterScene**  
  → (успішна реєстрація) → **LoginScene**

- **MainScene**  
  → (створення/приєднання до кімнати) → **RoomScene**

- **RoomScene**  
  → (старт гри) → **GameScene**  
  → (вихід з кімнати) → **MainScene**

- **GameScene**  
  → (завершення гри/вихід) → **MainScene** або **RoomScene**

---

## Взаємодія клієнт ↔ сервер

- Користувач логіниться через REST, отримує токен.
- Підключення до WebSocket можливе лише з валідним токеном.
- Кімнати мають статус (ACTIVE, GAME, INACTIVE).
- При зміні статусу на GAME всім гравцям кімнати встановлюється activeRoom.
- При видаленні кімнати activeRoom очищується у всіх гравців цієї кімнати.
- При виході з кімнати activeRoom очищується у користувача.
- Всі зміни (кімнати, гравці, статуси) синхронізуються через WebSocket.

---

## Розширення

- Архітектура дозволяє легко додавати нові типи подій, статуси кімнат, розширювати UserData та Room.
- Дані про користувачів і кімнати зберігаються у памʼяті (можна винести у БД).

---

**Цей файл можна оновлювати при зміні архітектури.**
